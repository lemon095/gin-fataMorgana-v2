# 提现逻辑测试用例

## 测试场景

### 场景1：正常提现流程
**初始状态：**
- 总余额：1000元
- 冻结余额：0元
- 可用余额：1000元

**步骤1：申请提现300元**
- 总余额：1000元（不变）
- 冻结余额：300元（+300）
- 可用余额：700元（-300）
- 交易状态：pending

**步骤2：确认提现**
- 总余额：700元（-300）
- 冻结余额：0元（-300）
- 可用余额：700元（不变）
- 交易状态：success

### 场景2：取消提现流程
**初始状态：**
- 总余额：1000元
- 冻结余额：0元
- 可用余额：1000元

**步骤1：申请提现200元**
- 总余额：1000元（不变）
- 冻结余额：200元（+200）
- 可用余额：800元（-200）
- 交易状态：pending

**步骤2：取消提现**
- 总余额：1000元（不变）
- 冻结余额：0元（-200）
- 可用余额：1000元（+200）
- 交易状态：cancelled

## 验证要点

1. **申请提现时：**
   - 只增加冻结余额，不减少总余额
   - 可用余额 = 总余额 - 冻结余额

2. **确认提现时：**
   - 减少总余额
   - 减少冻结余额
   - 可用余额不变

3. **取消提现时：**
   - 总余额不变
   - 减少冻结余额
   - 可用余额恢复

4. **数据一致性：**
   - 总余额 >= 冻结余额
   - 可用余额 = 总余额 - 冻结余额
   - 所有操作都有完整的交易记录

## 测试脚本

使用以下脚本进行测试：

```bash
# 1. 用户提现申请测试
./test_withdraw_flow.sh

# 2. 后台管理测试
./test_admin_withdraw.sh
```

## 预期结果

- 申请提现后，冻结余额增加，可用余额减少
- 确认提现后，总余额和冻结余额都减少
- 取消提现后，冻结余额减少，总余额不变
- 所有操作都有完整的审计日志 