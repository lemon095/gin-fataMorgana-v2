# Profileæ¥å£ vs Sessionæ¥å£å¯¹æ¯”

## æ¦‚è¿°

é¡¹ç›®ä¸­æä¾›äº†ä¸¤ä¸ªè·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£ï¼Œå®ƒä»¬æœ‰ä¸åŒçš„ç”¨é€”å’Œè¿”å›æ•°æ®ï¼š

## 1. Profileæ¥å£ (`POST /api/v1/auth/profile`)

### åŠŸèƒ½æè¿°
è·å–å½“å‰ç”¨æˆ·çš„**å®Œæ•´èµ„æ–™ä¿¡æ¯**ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„æ‰€æœ‰åŸºæœ¬ä¿¡æ¯å’Œä¸šåŠ¡æ•°æ®ã€‚

### å®ç°é€»è¾‘
```go
// AuthController.GetProfile
func (ac *AuthController) GetProfile(c *gin.Context) {
    userID := middleware.GetCurrentUser(c)
    user, err := ac.userService.GetUserByID(userID)
    // è¿”å›å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯
    utils.Success(c, gin.H{"user": user})
}
```

### æ•°æ®æ¥æº
- **æ•°æ®åº“æŸ¥è¯¢**: é€šè¿‡ `UserService.GetUserByID()` æŸ¥è¯¢æ•°æ®åº“
- **RedisæŸ¥è¯¢**: ä»Redisè·å–ç”¨æˆ·ç­‰çº§è¿›åº¦ (`rate`)
- **æ•°æ®è„±æ•**: å¯¹é‚®ç®±ã€æ‰‹æœºå·ç­‰æ•æ„Ÿä¿¡æ¯è¿›è¡Œè„±æ•å¤„ç†

### è¿”å›æ•°æ®
```json
{
  "code": 0,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "user": {
      "id": 1,
      "uid": "12345678",
      "username": "test_xxxxxx",
      "email": "t***@example.com",
      "phone": "",
      "bank_card_info": "",
      "experience": 0,
      "credit_score": 100,
      "status": 1,
      "invited_by": "7TRABJ",
      "has_group_buy_qualification": false,
      "rate": 0,
      "created_at": "2025-01-01T00:00:00Z"
    }
  }
}
```

### ç‰¹ç‚¹
- âœ… **æ•°æ®å®Œæ•´**: åŒ…å«ç”¨æˆ·çš„æ‰€æœ‰ä¸šåŠ¡ä¿¡æ¯
- âœ… **å®æ—¶æ•°æ®**: ä»æ•°æ®åº“å’ŒRedisè·å–æœ€æ–°æ•°æ®
- âœ… **æ•°æ®è„±æ•**: è‡ªåŠ¨å¯¹æ•æ„Ÿä¿¡æ¯è¿›è¡Œè„±æ•
- âœ… **ä¸šåŠ¡é€»è¾‘**: åŒ…å«ç­‰çº§è¿›åº¦ç­‰ä¸šåŠ¡æ•°æ®
- âš ï¸ **æ€§èƒ½å¼€é”€**: éœ€è¦æŸ¥è¯¢æ•°æ®åº“å’ŒRedis

---

## 2. Sessionæ¥å£ (`POST /api/v1/session/user`)

### åŠŸèƒ½æè¿°
è·å–å½“å‰**ä¼šè¯ä¸­çš„ç”¨æˆ·åŸºæœ¬ä¿¡æ¯**ï¼Œä¸»è¦ç”¨äºéªŒè¯ç™»å½•çŠ¶æ€å’Œè·å–åŸºæœ¬ä¼šè¯ä¿¡æ¯ã€‚

### å®ç°é€»è¾‘
```go
// SessionController.GetCurrentUserInfo
func (sc *SessionController) GetCurrentUserInfo(c *gin.Context) {
    userID := middleware.GetCurrentUser(c)
    username := middleware.GetCurrentUsername(c)
    // è¿”å›ä¼šè¯ä¸­çš„åŸºæœ¬ä¿¡æ¯
    utils.SuccessWithMessage(c, "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ", gin.H{
        "user_id":    userID,
        "username":   username,
        "login_time": time.Now().Unix(),
    })
}
```

### æ•°æ®æ¥æº
- **å†…å­˜æ•°æ®**: ä»JWT tokenè§£æå‡ºçš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå­˜å‚¨åœ¨ä¸­é—´ä»¶ä¸­ï¼‰
- **æ— æ•°æ®åº“æŸ¥è¯¢**: ç›´æ¥ä»tokenä¸­è·å–ä¿¡æ¯

### è¿”å›æ•°æ®
```json
{
  "code": 0,
  "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
  "data": {
    "user_id": 1,
    "username": "test_xxxxxx",
    "login_time": 1751365370
  }
}
```

### ç‰¹ç‚¹
- âœ… **æ€§èƒ½é«˜æ•ˆ**: æ— éœ€æŸ¥è¯¢æ•°æ®åº“ï¼Œç›´æ¥ä»tokenè·å–
- âœ… **å“åº”å¿«é€Ÿ**: æ¯«ç§’çº§å“åº”æ—¶é—´
- âœ… **è½»é‡çº§**: åªè¿”å›åŸºæœ¬ä¼šè¯ä¿¡æ¯
- âŒ **æ•°æ®æœ‰é™**: åªåŒ…å«tokenä¸­çš„åŸºæœ¬ä¿¡æ¯
- âŒ **éå®æ—¶**: æ•°æ®æ¥è‡ªtokenï¼Œå¯èƒ½ä¸æ˜¯æœ€æ–°çš„

---

## 3. è¯¦ç»†å¯¹æ¯”è¡¨

| ç‰¹æ€§ | Profileæ¥å£ | Sessionæ¥å£ |
|------|-------------|-------------|
| **æ¥å£è·¯å¾„** | `POST /api/v1/auth/profile` | `POST /api/v1/session/user` |
| **æ•°æ®æ¥æº** | æ•°æ®åº“ + Redis | JWT Token |
| **æ•°æ®å®Œæ•´æ€§** | å®Œæ•´ç”¨æˆ·èµ„æ–™ | åŸºæœ¬ä¼šè¯ä¿¡æ¯ |
| **å“åº”é€Ÿåº¦** | è¾ƒæ…¢ï¼ˆéœ€è¦æŸ¥è¯¢ï¼‰ | å¾ˆå¿«ï¼ˆå†…å­˜è·å–ï¼‰ |
| **æ•°æ®å®æ—¶æ€§** | å®æ—¶æœ€æ–°æ•°æ® | Tokenä¸­çš„å¿«ç…§æ•°æ® |
| **åŒ…å«å­—æ®µ** | æ‰€æœ‰ç”¨æˆ·å­—æ®µ | ä»…user_idã€usernameã€login_time |
| **æ•°æ®è„±æ•** | è‡ªåŠ¨è„±æ• | æ— è„±æ•å¤„ç† |
| **ä¸šåŠ¡æ•°æ®** | åŒ…å«ç­‰çº§è¿›åº¦ç­‰ | æ— ä¸šåŠ¡æ•°æ® |
| **ä½¿ç”¨åœºæ™¯** | ç”¨æˆ·èµ„æ–™é¡µé¢ | ç™»å½•çŠ¶æ€æ£€æŸ¥ |

---

## 4. ä½¿ç”¨å»ºè®®

### ä½•æ—¶ä½¿ç”¨Profileæ¥å£
- ğŸ“± **ç”¨æˆ·èµ„æ–™é¡µé¢**: æ˜¾ç¤ºå®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯
- ğŸ’³ **ä¸ªäººä¸­å¿ƒ**: éœ€è¦æ˜¾ç¤ºç»éªŒå€¼ã€ä¿¡ç”¨åˆ†ç­‰ä¸šåŠ¡æ•°æ®
- ğŸ”§ **è®¾ç½®é¡µé¢**: éœ€è¦ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯æ—¶
- ğŸ“Š **æ•°æ®å±•ç¤º**: éœ€è¦æ˜¾ç¤ºç”¨æˆ·ç­‰çº§è¿›åº¦ç­‰

### ä½•æ—¶ä½¿ç”¨Sessionæ¥å£
- ğŸ” **ç™»å½•çŠ¶æ€æ£€æŸ¥**: å¿«é€ŸéªŒè¯ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
- ğŸš€ **é¡µé¢åˆå§‹åŒ–**: éœ€è¦å¿«é€Ÿè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- âš¡ **æ€§èƒ½æ•æ„Ÿåœºæ™¯**: éœ€è¦æ¯«ç§’çº§å“åº”
- ğŸ”„ **é¢‘ç¹è°ƒç”¨**: ä¸éœ€è¦å®Œæ•´ç”¨æˆ·æ•°æ®çš„åœºæ™¯

---

## 5. ç¤ºä¾‹ä»£ç 

### å‰ç«¯ä½¿ç”¨ç¤ºä¾‹

```javascript
// è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨äºä¸ªäººèµ„æ–™é¡µé¢ï¼‰
async function getUserProfile() {
  const response = await fetch('/api/v1/auth/profile', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({})
  });
  return response.json();
}

// è·å–ä¼šè¯ä¿¡æ¯ï¼ˆç”¨äºç™»å½•çŠ¶æ€æ£€æŸ¥ï¼‰
async function getSessionInfo() {
  const response = await fetch('/api/v1/session/user', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({})
  });
  return response.json();
}
```

---

## 6. æ€»ç»“

ä¸¤ä¸ªæ¥å£å„æœ‰ä¼˜åŠ¿ï¼Œå»ºè®®æ ¹æ®å…·ä½“ä½¿ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„æ¥å£ï¼š

- **Profileæ¥å£**: é€‚ç”¨äºéœ€è¦å®Œæ•´ç”¨æˆ·ä¿¡æ¯çš„åœºæ™¯
- **Sessionæ¥å£**: é€‚ç”¨äºéœ€è¦å¿«é€ŸéªŒè¯ç™»å½•çŠ¶æ€çš„åœºæ™¯

è¿™æ ·çš„è®¾è®¡æ—¢ä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§ï¼Œåˆä¼˜åŒ–äº†æ€§èƒ½ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¶æ„è®¾è®¡ã€‚ 